        // Language translations
        const translations = {
            en: {
                // Header
                headerTitle: "ASHA Worker Registration",
                headerSubtitle: "Smart Health Monitor",
                backToHome: "Back to Home",
                
                // Form
                formTitle: "ASHA Worker Registration",
                formSubtitle: "Join our community health monitoring network",
                
                // Sections
                personalInfoTitle: "Personal Information",
                contactInfoTitle: "Contact Information",
                professionalInfoTitle: "Professional Information",
                accountSetupTitle: "Account Setup",
                
                // Labels
                nameLabel: "Name:",
                namePlaceholder: "Enter your full name",
                dobLabel: "Date of Birth:",
                mobileLabel: "Mobile Number:",
                mobilePlaceholder: "Enter your mobile number",
                emailLabel: "Email:",
                emailPlaceholder: "Enter your email address",
                ashaIdLabel: "ASHA ID:",
                ashaIdPlaceholder: "Enter your ASHA ID",
                districtLabel: "District:",
                selectDistrictOption: "Select District",
                usernameLabel: "Username:",
                usernamePlaceholder: "Choose a username",
                passwordLabel: "Password:",
                passwordPlaceholder: "Create a password",
                
                // Button
                registerButton: "Register"
            },
            as: {
                // Header
                headerTitle: "আশা কৰ্মীৰ নিবন্ধন",
                headerSubtitle: "স্মাৰ্ট স্বাস্থ্য মনিটৰ",
                backToHome: "মুখপৃষ্ঠালৈ ঘূৰি যাওক",
                
                // Form
                formTitle: "আশা কৰ্মীৰ নিবন্ধন",
                formSubtitle: "আমাৰ সম্প্ৰদায় স্বাস্থ্য মনিটৰিং নেটৱৰ্কত যোগদান কৰক",
                
                // Sections
                personalInfoTitle: "ব্যক্তিগত তথ্য",
                contactInfoTitle: "যোগাযোগৰ তথ্য",
                professionalInfoTitle: "বৃত্তিমূলক তথ্য",
                accountSetupTitle: "একাউণ্ট ছেটআप",
                
                // Labels
                nameLabel: "নাম:",
                namePlaceholder: "আপোনাৰ সম্পূৰ্ণ নাম সুমুৱাওক",
                dobLabel: "জন্ম তাৰিখ:",
                mobileLabel: "ম'বাইল নম্বৰ:",
                mobilePlaceholder: "আপোনাৰ ম'বাইল নম্বৰ সুমুৱাওক",
                emailLabel: "ইমেইল:",
                emailPlaceholder: "আপোনাৰ ইমেইল ঠিকনা সুমুৱাওক",
                ashaIdLabel: "আশা ID:",
                ashaIdPlaceholder: "আপোনাৰ আশা ID সুমুৱাওক",
                districtLabel: "জিলা:",
                selectDistrictOption: "জিলা নিৰ্বাচন কৰক",
                usernameLabel: "ব্যৱহাৰকাৰী নাম:",
                usernamePlaceholder: "এটা ব্যৱহাৰকাৰী নাম বাছনি কৰক",
                passwordLabel: "পাছৱৰ্ড:",
                passwordPlaceholder: "এটা পাছৱৰ্ড সৃষ্টি কৰক",
                
                // Button
                registerButton: "নিবন্ধন কৰক"
            },
            bn: {
                // Header
                headerTitle: "আশা কর্মী নিবন্ধন",
                headerSubtitle: "স্মার্ট স্বাস্থ্য মনিটর",
                backToHome: "হোমপেজে ফিরে যান",
                
                // Form
                formTitle: "আশা কর্মী নিবন্ধন",
                formSubtitle: "আমাদের কমিউনিটি হেলথ মনিটরিং নেটওয়ার্কে যোগ দিন",
                
                // Sections
                personalInfoTitle: "ব্যক্তিগত তথ্য",
                contactInfoTitle: "যোগাযোগের তথ্য",
                professionalInfoTitle: "পেশাগত তথ্য",
                accountSetupTitle: "অ্যাকাউন্ট সেটআপ",
                
                // Labels
                nameLabel: "নাম:",
                namePlaceholder: "আপনার সম্পূর্ণ নাম লিখুন",
                dobLabel: "জন্ম তারিখ:",
                mobileLabel: "মোবাইল নম্বর:",
                mobilePlaceholder: "আপনার মোবাইল নম্বর লিখুন",
                emailLabel: "ইমেল:",
                emailPlaceholder: "আপনার ইমেল ঠিকানা লিখুন",
                ashaIdLabel: "আশা আইডি:",
                ashaIdPlaceholder: "আপনার আশা আইডি লিখুন",
                districtLabel: "জেলা:",
                selectDistrictOption: "জেলা নির্বাচন করুন",
                usernameLabel: "ব্যবহারকারীর নাম:",
                usernamePlaceholder: "একটি ব্যবহারকারীর নাম চয়ন করুন",
                passwordLabel: "পাসওয়ার্ড:",
                passwordPlaceholder: "একটি পাসওয়ার্ড তৈরি করুন",
                
                // Button
                registerButton: "নিবন্ধন করুন"
            },
            hi: {
                // Header
                headerTitle: "आशा कार्यकर्ता पंजीकरण",
                headerSubtitle: "स्मार्ट स्वास्थ्य मॉनिटर",
                backToHome: "होमपेज पर वापस जाएं",
                
                // Form
                formTitle: "आशा कार्यकर्ता पंजीकरण",
                formSubtitle: "हमारे सामुदायिक स्वास्थ्य निगरानी नेटवर्क से जुड़ें",
                
                // Sections
                personalInfoTitle: "व्यक्तिगत जानकारी",
                contactInfoTitle: "संपर्क जानकारी",
                professionalInfoTitle: "पेशेवर जानकारी",
                accountSetupTitle: "खाता सेटअप",
                
                // Labels
                nameLabel: "नाम:",
                namePlaceholder: "अपना पूरा नाम दर्ज करें",
                dobLabel: "जन्म तिथि:",
                mobileLabel: "मोबाइल नंबर:",
                mobilePlaceholder: "अपना मोबाइल नंबर दर्ज करें",
                emailLabel: "ईमेल:",
                emailPlaceholder: "अपना ईमेल पता दर्ज करें",
                ashaIdLabel: "आशा आईडी:",
                ashaIdPlaceholder: "अपना आशा आईडी दर्ज करें",
                districtLabel: "जिला:",
                selectDistrictOption: "जिला चुनें",
                usernameLabel: "उपयोगकर्ता नाम:",
                usernamePlaceholder: "एक उपयोगकर्ता नाम चुनें",
                passwordLabel: "पासवर्ड:",
                passwordPlaceholder: "एक पासवर्ड बनाएं",
                
                // Button
                registerButton: "पंजीकरण करें"
            }
        };

        // Global state
        let currentLanguage = 'en';

        // Initialize Lucide icons
        if (typeof lucide !== 'undefined' && lucide.createIcons) {
            lucide.createIcons();
        }
        
  // Form submission handling - UPDATED VERSION
document.getElementById('ashaRegistrationForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Get form data
    const formData = new FormData(e.target);
    const formObject = Object.fromEntries(formData.entries());
    
    // Add role to the data
    const registrationData = {
        ...formObject,
        role: 'asha'  // This is correct for ASHA workers
    };
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>Registering...</span>';
    
    try {
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(registrationData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('Registration successful! You can now login.');
            e.target.reset();
            
            // Redirect to login page after success
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
            
        } else {
            alert('Registration failed: ' + result.error);
        }
    } catch (error) {
        console.error('Registration error:', error);
        alert('Registration failed. Please try again.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
});

        // Language functions
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-dropdown');
            dropdown.classList.toggle('show');
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            const langNames = {
                en: 'English',
                as: 'Assamese',
                bn: 'Bengali',
                hi: 'Hindi'
            };
            
            document.getElementById('current-language').textContent = langNames[lang];
            document.getElementById('language-dropdown').classList.remove('show');
            
            updatePageContent();
            localStorage.setItem('language', lang);
        }

        // Update page content with translations
        function updatePageContent() {
            const t = translations[currentLanguage];
            if (!t) {
                console.error(`Translations not found for language: ${currentLanguage}`);
                return;
            }

            // Helper function to safely set text content
            const setText = (selector, text) => {
                const element = document.querySelector(selector);
                if (element) {
                    element.textContent = text;
                }
            };

            // Helper function to safely set placeholder
            const setPlaceholder = (selector, text) => {
                const element = document.querySelector(selector);
                if (element) {
                    element.placeholder = text;
                }
            };

            // Update header
            setText('#header-title', t.headerTitle);
            setText('#header-subtitle', t.headerSubtitle);
            setText('#back-to-home', t.backToHome);
            
            // Update form titles
            setText('#form-title', t.formTitle);
            setText('#form-subtitle', t.formSubtitle);
            
            // Update section titles
            setText('#personal-info-title', t.personalInfoTitle);
            setText('#contact-info-title', t.contactInfoTitle);
            setText('#professional-info-title', t.professionalInfoTitle);
            setText('#account-setup-title', t.accountSetupTitle);
            
            // Update labels and placeholders
            setText('#name-label', t.nameLabel);
            setPlaceholder('#name-placeholder', t.namePlaceholder);
            setText('#dob-label', t.dobLabel);
            setText('#mobile-label', t.mobileLabel);
            setPlaceholder('#mobile-placeholder', t.mobilePlaceholder);
            setText('#email-label', t.emailLabel);
            setPlaceholder('#email-placeholder', t.emailPlaceholder);
            setText('#asha-id-label', t.ashaIdLabel);
            setPlaceholder('#asha-id-placeholder', t.ashaIdPlaceholder);
            setText('#district-label', t.districtLabel);
            setText('#select-district-option', t.selectDistrictOption);
            setText('#username-label', t.usernameLabel);
            setPlaceholder('#username-placeholder', t.usernamePlaceholder);
            setText('#password-label', t.passwordLabel);
            setPlaceholder('#password-placeholder', t.passwordPlaceholder);
            
            // Update button
            setText('#register-button', t.registerButton);
        }

        function setupEventListeners() {
            document.getElementById('language-btn')?.addEventListener('click', toggleLanguageDropdown);
            
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', () => {
                    changeLanguage(option.dataset.lang);
                });
            });
            
            document.addEventListener('click', (e) => {
                const languageSelector = document.querySelector('.language-selector');
                if (languageSelector && !languageSelector.contains(e.target)) {
                    document.getElementById('language-dropdown')?.classList.remove('show');
                }
            });
        }

        function loadLanguagePreference() {
            const savedLanguage = localStorage.getItem('language');
            if (savedLanguage && translations[savedLanguage]) {
                changeLanguage(savedLanguage);
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            loadLanguagePreference();
            // Initialize Lucide icons again to ensure they're properly rendered
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        });